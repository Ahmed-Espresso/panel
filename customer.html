<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ููุญุฉ ุงูุชุญูู - ุงูุชูุงุตู ุงูุณุฑูุน</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="admin-style.css">
</head>
<body>
  <header>
    <nav>
      <ul class="navbar-admin">
        <li><a href="index.html" class="active"><i class="fas fa-home"></i> ุฑุณุงูุฉ ุชุฑุญูุจ</a></li>
        <li><a href="category.html"><i class="fas fa-list"></i> ุงูุฃูุณุงู</a></li>
        <li><a href="product.html"><i class="bi bi-box-seam"></i> ุงูููุชุฌุงุช</a></li>
        <li><a href="time.html"><i class="bi bi-tags-fill"></i> ุงูุนุฑูุถ</a></li>
        <li><a href="bot.html"><i class="fas fa-robot"></i> ุงูุดุงุช</a></li>
        <li><a href="who.html"><i class="bi bi-book-half"></i>  ูุตุชูุง</a></li>
        <li><a href="contact.html"><i class="fas fa-address-book"></i> ุงูุชูุงุตู</a></li>
        <li><a href="stats.html"><i class="bi bi-bar-chart-line-fill"></i>ุงุญุตุงุฆูุงุช</a></li>
        <li><a href="serv.html"><i class="bi bi-gear-fill"></i> ุงูุฎุฏูุงุช</a></li>
        <li><a href="faq.html"><i class="bi bi-question-circle-fill"></i> ุณุคุงู ูุฌูุงุจ</a></li>
        <li><a href="customer.html"><i class="fas fa-bolt"></i> ุฎุฏูู ุงูุนููุงุก</a></li>
        <li><a href="translation.html"><i class="fas fa-language"></i> ุงูุชุฑุฌูู</a></li>
      </ul>
    </nav>
  </header>
 <div class="container">
  <div class="form-container">
     <h1><i class="fas fa-comment-dots"></i> ุฅุนุฏุงุฏุงุช ุฎุฏูู ุงูุนููุงุก</h1>
    <form id="qcForm">
      <!-- Country Code + Local Phone -->
      <div class="form-group">
        <label for="qcCountryCode">ููุฏ ุงูุฏููุฉ</label>
        <select id="qcCountryCode" class="form-control">
          <option value="+20">+20 (ูุตุฑ)</option>
          <option value="+966">+966 (ุงูุณุนูุฏูุฉ)</option>
          <option value="+971">+971 (ุงูุฅูุงุฑุงุช)</option>
          <option value="+1">+1 (USA)</option>
          <option value="+44">+44 (UK)</option>
        </select>
      </div>
      <div class="form-group">
        <label for="qcPhoneLocal">ุฑูู ุงููุงุชู (ุจุฏูู ููุฏ)</label>
        <input type="tel" id="qcPhoneLocal" class="form-control" placeholder="ูุซูุงู 01012345678">
      </div>

      <!-- Email -->
      <div class="form-group">
        <label for="emailAddress">ุงูุฅูููู ุงูููุณุชูุจู</label>
        <input type="email" id="emailAddress" class="form-control" placeholder="example@mail.com">
      </div>

      <hr>

      <!-- WhatsApp Button Settings -->
      <h2>ุฅุนุฏุงุฏ ุฒุฑ ุงููุงุชุณุงุจ</h2>
      <div class="form-group">
        <label>ุฃููููุฉ ุงูุฒุฑ</label>
        <div id="whatsappIconPicker" class="icon-options icon-picker">
            <span data-icon="fa-brands fa-whatsapp"><i class="fa-brands fa-whatsapp fa-2x"></i></span>
            <span data-icon="fa-solid fa-comment"><i class="fa-solid fa-comment fa-2x"></i></span>
            <span data-icon="fa-brands fa-telegram"><i class="fa-brands fa-telegram fa-2x"></i></span>
            <span data-icon="fa-solid fa-message"><i class="fa-solid fa-message fa-2x"></i></span>
        </div>
        <input type="hidden" id="buttonWhatsappIcon" required>
      </div>
      <div class="form-group lang-pair">
        <div>
          <label for="buttonWhatsappLabelAr">ูุต ุงูุฒุฑ (AR)</label>
          <input type="text" id="buttonWhatsappLabelAr" class="form-control" placeholder="ุฃุฑุณู ุนุจุฑ ูุงุชุณ" required>
        </div>
        <div>
          <label for="buttonWhatsappLabelEn">Button (EN)</label>
          <input type="text" id="buttonWhatsappLabelEn" class="form-control" placeholder="Send via WhatsApp" required>
        </div>
      </div>

      <hr>

      <!-- Email Button Settings -->
      <h2>ุฅุนุฏุงุฏ ุฒุฑ ุงูุฅูููู</h2>
      <div class="form-group">
        <label>ุฃููููุฉ ุงูุฒุฑ</label>
        <div id="emailIconPicker" class="icon-options">
          <span data-icon="fa-solid fa-envelope"><i class="fa-solid fa-envelope fa-2x"></i></span>
          <span data-icon="fa-solid fa-paper-plane"><i class="fa-solid fa-paper-plane fa-2x"></i></span>
          <span data-icon="fa-brands fa-google"><i class="fa-brands fa-google fa-2x"></i></span>
          <span data-icon="fa-solid fa-at"><i class="fa-solid fa-at fa-2x"></i></span>
        </div>
        <input type="hidden" id="buttonEmailIcon" required>
      </div>
      <div class="form-group lang-pair">
        <div>
          <label for="buttonEmailLabelAr">ูุต ุงูุฒุฑ (AR)</label>
          <input type="text" id="buttonEmailLabelAr" class="form-control" placeholder="ุฃุฑุณู ุนุจุฑ ุฅูููู" required>
        </div>
        <div>
          <label for="buttonEmailLabelEn">Button (EN)</label>
          <input type="text" id="buttonEmailLabelEn" class="form-control" placeholder="Send via Email" required>
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary">๐พ ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
      </div>
    </form>

    <div id="qcMessageBox" class="message-box"></div>

    <div class="current-settings">
      <h2>ุงูุฅุนุฏุงุฏุงุช ุงูุญุงููุฉ</h2>
      <p>๐ฑ ูุงุชุณุงุจ: <span id="currentWhatsapp">โ</span></p>
      <p>โ๏ธ ุฅูููู: <span id="currentEmail">โ</span></p>
      <p>๐ ุฒุฑ ูุงุชุณุงุจ: <i id="currentBtnWAIcon"></i> <span id="currentBtnWALabelAr"></span> / <span id="currentBtnWALabelEn"></span></p>
      <p>๐ ุฒุฑ ุฅูููู:   <i id="currentBtnEMIcon"></i> <span id="currentBtnEMLabelAr"></span> / <span id="currentBtnEMLabelEn"></span></p>
    </div>
  </div>
</div>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    // Firebase init
    const firebaseConfig = {
      apiKey: "AIzaSyAtqvEzoqQoCtHS_wvc5mAzb5WKOW1MaeI",
      authDomain: "realestate-d4e29.firebaseapp.com",
      databaseURL: "https://realestate-d4e29-default-rtdb.firebaseio.com",
      projectId: "realestate-d4e29",
      storageBucket: "realestate-d4e29.appspot.com",
      messagingSenderId: "341854632202",
      appId: "1:341854632202:web:7666024e83d2b9c94962f3"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);
    const qcRef = ref(db, 'storeQuickContact');

    // DOM
    const form          = document.getElementById('qcForm');
    const msgBox        = document.getElementById('qcMessageBox');
    const countryCode   = document.getElementById('qcCountryCode');
    const phoneLocal    = document.getElementById('qcPhoneLocal');
    const emailInput    = document.getElementById('emailAddress');
    const btnWAIconIn   = document.getElementById('buttonWhatsappIcon');
    const labelWAArIn   = document.getElementById('buttonWhatsappLabelAr');
    const labelWAEnIn   = document.getElementById('buttonWhatsappLabelEn');
    const btnEMIconIn   = document.getElementById('buttonEmailIcon');
    const labelEMArIn   = document.getElementById('buttonEmailLabelAr');
    const labelEMEnIn   = document.getElementById('buttonEmailLabelEn');

    // Current display
    const curWp         = document.getElementById('currentWhatsapp');
    const curEm         = document.getElementById('currentEmail');
    const curWAIcon     = document.getElementById('currentBtnWAIcon');
    const curWAArLab    = document.getElementById('currentBtnWALabelAr');
    const curWAEnLab    = document.getElementById('currentBtnWALabelEn');
    const curEMIcon     = document.getElementById('currentBtnEMIcon');
    const curEMArLab    = document.getElementById('currentBtnEMLabelAr');
    const curEMEnLab    = document.getElementById('currentBtnEMLabelEn');

    // Utility
    const onlyDigits = s => s.replace(/\D/g, '');

    // Load existing
    onValue(qcRef, snap => {
      const d = snap.val() || {};

      // phone parsing
      let found = false;
      Array.from(countryCode.options).forEach(o => {
        const cd = onlyDigits(o.value);
        if (d.whatsappNumber?.startsWith(cd)) {
          countryCode.value = o.value;
          phoneLocal.value  = d.whatsappNumber.slice(cd.length);
          found = true;
        }
      });
      if (!found) {
        countryCode.value = '+20';
        phoneLocal.value  = d.whatsappNumber || '';
      }

      emailInput.value         = d.emailAddress || '';
      btnWAIconIn.value        = d.buttonWhatsappIcon || '';
      labelWAArIn.value        = d.buttonWhatsappLabel?.ar || '';
      labelWAEnIn.value        = d.buttonWhatsappLabel?.en || '';
      btnEMIconIn.value        = d.buttonEmailIcon || '';
      labelEMArIn.value        = d.buttonEmailLabel?.ar || '';
      labelEMEnIn.value        = d.buttonEmailLabel?.en || '';

      // icon pickers
      document.querySelectorAll('#whatsappIconPicker span').forEach(el =>
        el.classList.toggle('selected', el.dataset.icon === d.buttonWhatsappIcon)
      );
      document.querySelectorAll('#emailIconPicker span').forEach(el =>
        el.classList.toggle('selected', el.dataset.icon === d.buttonEmailIcon)
      );

      // display
      curWp.textContent       = d.whatsappNumber || 'โ';
      curEm.textContent       = d.emailAddress || 'โ';
      curWAIcon.className     = d.buttonWhatsappIcon || '';
      curWAArLab.textContent  = d.buttonWhatsappLabel?.ar || 'โ';
      curWAEnLab.textContent  = d.buttonWhatsappLabel?.en || 'โ';
      curEMIcon.className     = d.buttonEmailIcon || '';
      curEMArLab.textContent  = d.buttonEmailLabel?.ar || 'โ';
      curEMEnLab.textContent  = d.buttonEmailLabel?.en || 'โ';
    });

    // icon pickers
    function initPicker(id, hid) {
      document.querySelectorAll(`#${id} span`).forEach(el => {
        el.onclick = () => {
          document.getElementById(hid).value = el.dataset.icon;
          document.querySelectorAll(`#${id} span`).forEach(x => x.classList.remove('selected'));
          el.classList.add('selected');
        };
      });
    }
    initPicker('whatsappIconPicker','buttonWhatsappIcon');
    initPicker('emailIconPicker','buttonEmailIcon');

    // submit
    form.addEventListener('submit', async e => {
      e.preventDefault();
      msgBox.textContent = '';

      const cc   = onlyDigits(countryCode.value);
      const loc  = onlyDigits(phoneLocal.value).replace(/^0+/, '');
      const full = cc + loc;

      if (!loc && !emailInput.value.trim()) {
        msgBox.className = 'message-box error';
        return msgBox.textContent = 'โ ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูู ูุงุชู ุฃู ุจุฑูุฏ ุฅููุชุฑููู';
      }

      const payload = {
        whatsappNumber: full,
        emailAddress:   emailInput.value.trim(),
        buttonWhatsappIcon: btnWAIconIn.value,
        buttonWhatsappLabel: { ar: labelWAArIn.value.trim(), en: labelWAEnIn.value.trim() },
        buttonEmailIcon: btnEMIconIn.value,
        buttonEmailLabel: { ar: labelEMArIn.value.trim(), en: labelEMEnIn.value.trim() }
      };

      try {
        await update(qcRef, payload);
        msgBox.className = 'message-box success';
        msgBox.textContent = 'โ ุชู ุญูุธ ุฅุนุฏุงุฏุงุช ุงูุชูุงุตู ุงูุณุฑูุน';
      } catch (err) {
        msgBox.className = 'message-box error';
        msgBox.textContent = 'โ ุฎุทุฃ: ' + err.message;
      }
    });

  </script>
  <script>
    // ููุฏ JavaScript ูุชูููุฒ ุงูุตูุญุฉ ุงููุดุทุฉ
    document.addEventListener('DOMContentLoaded', function() {
      // ุงูุญุตูู ุนูู ุฌููุน ุฑูุงุจุท ุงููุงุฆูุฉ
      const links = document.querySelectorAll('.navbar-admin a');
      // ุงูุญุตูู ุนูู ุงููุณุงุฑ ุงูุญุงูู (ูุซู '/category.html')
      const currentPath = window.location.pathname;
      // ุงุณุชุฎุฑุงุฌ ุงุณู ุงูููู ูู ุงููุณุงุฑ
      const currentPage = currentPath.split('/').pop() || 'index.html';
      
      // ุงูุจุญุซ ุนู ุงูุฑุงุจุท ุงูุฐู ูุญุชูู ุนูู ุณูุฉ href ุชูุชูู ุจุงุณู ุงูููู ุงูุญุงูู
      links.forEach(link => {
        const linkHref = link.getAttribute('href');
        const linkPage = linkHref.split('/').pop();
        
        // ุฅุฐุง ุชุทุงุจู ุงุณู ุงูููู ุงูุญุงูู ูุน ุงุณู ุงูููู ูู ุงูุฑุงุจุท
        if (currentPage === linkPage) {
          // ุฅุฒุงูุฉ ุงูููุงุณ ุงููุดุท ูู ุฌููุน ุงูุฑูุงุจุท
          links.forEach(l => l.classList.remove('active'));
          // ุฅุถุงูุฉ ุงูููุงุณ ุงููุดุท ููุฑุงุจุท ุงูุญุงูู
          link.classList.add('active');
        }
      });
      
      // ุฅุถุงูุฉ ุฑุณุงูุฉ ูู ูุญุฏุฉ ุงูุชุญูู ูุชูุถูุญ ุงูุนูููุฉ
      console.log(`ุงูุตูุญุฉ ุงูุญุงููุฉ: ${currentPage}`);
      console.log('ุชู ุชูููุฒ ุงูุฑุงุจุท ุงููุดุท ุจูุฌุงุญ!');
    });
  </script>
</body>
</html>